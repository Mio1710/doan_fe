import{_ as g}from"./BtS7m9iX.js";import{V as A,s as F}from"./tiE9t01t.js";import{d as U,r as w,a as C,P as W,t as k,L as D,A as n,M as i,v as b,x as m,z as t,B as x,V as S,y as T,N as E,R as $,Q as M,O as R,i as N,S as j,W as X}from"./CqP_eWgs.js";import{r as J,u as I}from"./DG2X6oDA.js";import{_ as L}from"./K1KuR4TM.js";import{V as G}from"./DasNMYfy.js";import{V as z}from"./DtRgzco-.js";import{P as K,_ as O}from"./DZ_F3gcz.js";import{V as Y}from"./B_0wuXyI.js";import{V as Z}from"./DmrsZ6zT.js";import"./Debhx5xt.js";import"./DONM5gkJ.js";import"./DNAAebiG.js";import"./BN51xDYQ.js";import"./CeLOGc9e.js";import"./R27po0-W.js";const ee={key:0},te={class:"d-flex items-center"},le={key:0},ne={key:1},se={key:0},ie={key:1},oe={key:0},ae={key:1},ue={key:1},de={class:"mt-4"},re={class:"max-w-[520px] ma-auto d-flex"},me={class:"d-none"},pe=U({__name:"ImportStudentTopic",emits:["cancel","success"],setup(r,{emit:v}){const s=w(null),{$api:a,$toast:V}=C(),f=v,c=W(),h=w(!1),p=w(!1),d=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Sinh viên",key:"ten",width:"20%",minWidth:200},{title:"Mã số",key:"maso",minWidth:100},{title:"Email",key:"email",minWidth:100},{title:"Ngày sinh",key:"ngay_sinh",minWidth:100},{title:"Lớp",key:"lop",width:"15%",minWidth:100,align:"center"}],e=()=>{a.studentTopic.importStudentTopic(F.serialize({file:s.value})).then(_=>{if(_.size>2106){V.error("Dữ liệu không hợp lệ, vui lòng kiểm tra lại!");const o=URL.createObjectURL(new Blob([_])),u=document.createElement("a");u.href=o,u.setAttribute("download","error_student.xlsx"),document.body.appendChild(u),u.click()}else V.success("Import sinh viên thành công");c.invalidateQueries("student-topic"),f("cancel"),f("success")}).finally(()=>{p.value=!1})},l=["STT","maso","hodem","ten","ngay_sinh","lop","email"],y=w([]),q=()=>{const _=new FileReader;if(s.value){if(console.log("check file",s,s.value),s.value.size>5*1024*1024){V.error("File phải nhỏ hơn 5MB");return}_.onload=o=>{var u;if(console.log("check event",o.target),(u=o.target)!=null&&u.result){const H=J(o.target.result,{type:"binary",cellDates:!0}),P=H.Sheets[H.SheetNames[0]],B=I.sheet_to_json(P,{header:1})[0];if(JSON.stringify(B)!==JSON.stringify(l)){V.error("File không đúng định dạng");return}const Q=I.sheet_to_json(P);h.value=!0,y.value=Q}},_.readAsBinaryString(s.value)}};return(_,o)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy","hide-submit":!i(h),title:"Import sinh viên khóa luận",onCancel:o[2]||(o[2]=u=>f("cancel")),onSubmit:e},{default:n(()=>[i(h)?(k(),b("div",ee,[m("div",te,[t(S,{class:"ma-2",color:"error"},{default:n(()=>o[3]||(o[3]=[x("mdi-alert-circle")])),_:1}),o[4]||(o[4]=m("span",null,"Dữ liệu không hợp lệ có thể không được lưu!",-1))]),t(G,{headers:d,height:"400","item-value":"name",items:i(y)},{"item.index":n(({index:u})=>[m("span",null,T(u+1),1)]),"item.ten":n(({item:u})=>[u.hodem&&u.ten?(k(),b("span",le,T(u.hodem+" "+u.ten),1)):(k(),b("span",ne,[t(S,{color:"error"},{default:n(()=>o[5]||(o[5]=[x("mdi-alert-circle")])),_:1})]))]),"item.maso":n(({item:u})=>[u.maso?(k(),b("span",se,T(u.maso),1)):(k(),b("span",ie,[t(S,{color:"error"},{default:n(()=>o[6]||(o[6]=[x("mdi-alert-circle")])),_:1})]))]),"item.email":n(({item:u})=>[u.email?(k(),b("span",oe,T(u.email),1)):(k(),b("span",ae,[t(S,{color:"error"},{default:n(()=>o[7]||(o[7]=[x("mdi-alert-circle")])),_:1})]))]),_:1},8,["items"])])):(k(),b("div",ue,[o[9]||(o[9]=m("div",{class:"mt-5"},[x(" Tải xuống mẫu import dữ liệu: "),m("a",{download:"",href:"/files/student_topic_template.xlsx",target:"_blank"},"download")],-1)),m("div",de,[m("div",re,[t(A,{modelValue:i(s),"onUpdate:modelValue":o[0]||(o[0]=u=>E(s)?s.value=u:null),accept:".xlsx",class:"w-full mr-4",label:"File dữ liệu",variant:"outlined"},null,8,["modelValue"]),m("div",me,[t(g,{modelValue:i(s),"onUpdate:modelValue":o[1]||(o[1]=u=>E(s)?s.value=u:null),rules:"required"},null,8,["modelValue"])]),t($,{color:"success",disabled:!i(s),onClick:q},{default:n(()=>o[8]||(o[8]=[x("Xem trước")])),_:1},8,["disabled"])])])]))]),_:1},8,["hide-submit"]))}}),ce=U({__name:"CreateStudentTopic",emits:["cancel","success"],setup(r,{emit:v}){const s=w({hodem:"",ten:"",email:"",maso:"",lop:"",phone:""}),{$api:a,$toast:V}=C(),f=v,c=W(),h=()=>{a.admin.createStudentTopic(s.value).then(()=>{V.success("Thêm mới sinh viên khóa luận thành công"),c.invalidateQueries("student-topic"),f("success"),f("cancel")})};return(p,d)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy",title:"Thêm mới sinh viên khóa luận",onCancel:d[6]||(d[6]=e=>f("cancel")),onSubmit:h},{default:n(()=>[t(g,{modelValue:i(s).hodem,"onUpdate:modelValue":d[0]||(d[0]=e=>i(s).hodem=e),label:"Họ đệm",name:"Họ đệm",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(s).ten,"onUpdate:modelValue":d[1]||(d[1]=e=>i(s).ten=e),label:"Tên sinh viên",name:"Tên sinh viên",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(s).maso,"onUpdate:modelValue":d[2]||(d[2]=e=>i(s).maso=e),label:"Mã số",name:"Mã số",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(s).email,"onUpdate:modelValue":d[3]||(d[3]=e=>i(s).email=e),label:"Email",name:"Email",rules:"required|email"},null,8,["modelValue"]),t(g,{modelValue:i(s).lop,"onUpdate:modelValue":d[4]||(d[4]=e=>i(s).lop=e),label:"Lớp",name:"Lớp",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(s).phone,"onUpdate:modelValue":d[5]||(d[5]=e=>i(s).phone=e),label:"Số điện thoại",name:"Số điện thoại"},null,8,["modelValue"])]),_:1}))}}),fe=U({__name:"UpdateStudentTopic",props:{studentTopic:{type:Object,required:!0}},emits:["cancel","success"],setup(r,{emit:v}){const a=w({...r.studentTopic}),{$api:V,$toast:f}=C(),c=v,h=W(),p=()=>{V.admin.updateStudentTopic(a.value.id,a.value).then(()=>{f.success("Cập nhật sinh viên khóa luận thành công"),h.invalidateQueries("student-topic"),c("success"),c("cancel")})};return(d,e)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy",title:"Cập nhật sinh viên khóa luận",onCancel:e[6]||(e[6]=l=>c("cancel")),onSubmit:p},{default:n(()=>[t(g,{modelValue:i(a).hodem,"onUpdate:modelValue":e[0]||(e[0]=l=>i(a).hodem=l),label:"Họ đệm",name:"Họ đệm",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(a).ten,"onUpdate:modelValue":e[1]||(e[1]=l=>i(a).ten=l),label:"Tên sinh viên",name:"Tên sinh viên",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(a).maso,"onUpdate:modelValue":e[2]||(e[2]=l=>i(a).maso=l),label:"Mã số",name:"Mã số",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(a).email,"onUpdate:modelValue":e[3]||(e[3]=l=>i(a).email=l),label:"Email",name:"Email",rules:"required|email"},null,8,["modelValue"]),t(g,{modelValue:i(a).lop,"onUpdate:modelValue":e[4]||(e[4]=l=>i(a).lop=l),label:"Lớp",name:"Lớp",rules:"required"},null,8,["modelValue"]),t(g,{modelValue:i(a).phone,"onUpdate:modelValue":e[5]||(e[5]=l=>i(a).phone=l),label:"Số điện thoại",name:"Số điện thoại"},null,8,["modelValue"])]),_:1}))}}),he={class:"text-center text-warning"},ve=U({__name:"DeleteStudentTopicConfirmDialog",props:{studentTopic:{type:Object,required:!0}},emits:["success"],setup(r,{emit:v}){const s=r,a=v,{$api:V,$toast:f}=C(),c=()=>{V.admin.deleteStudentTopic(s.studentTopic.id).then(()=>{f.success("Xóa sinh viên khóa luận thành công"),a("success")})};return(h,p)=>(k(),D(z,{"min-width":"400",width:"40%"},{activator:n(({props:d})=>[t($,M(d,{color:"error",icon:"",size:"small",variant:"text"}),{default:n(()=>[t(S,null,{default:n(()=>p[0]||(p[0]=[x("mdi-trash-can")])),_:1})]),_:2},1040)]),default:n(({isActive:d})=>[t(L,{"can-cancel":"","cancel-text":"Hủy","submit-text":"Xóa",title:"Xác nhận xóa sinh viên khóa luận",onCancel:e=>d.value=!1,onSubmit:c},{default:n(()=>[m("div",he,[m("span",null,[t(S,null,{default:n(()=>p[1]||(p[1]=[x("mdi-warning")])),_:1}),p[2]||(p[2]=x(" Xóa sinh viên ")),m("strong",null,T(r.studentTopic.hodem)+" "+T(r.studentTopic.ten)+" - "+T(r.studentTopic.maso),1),p[3]||(p[3]=x(" khỏi hệ thống? "))])])]),_:2},1032,["onCancel"])]),_:1}))}});function Ve(r,v){return r?Array.isArray(r)?O.map(O.zip(r,v),([s,a])=>a==="desc"?`-${s}`:s):[v==="desc"?`-${r}`:r]:[]}function ye(r,v){const{$api:s}=C(),a=R(["student-topic",r],()=>{const{sortBy:c,sortType:h}=r.value,p=Ve(c,h),d=new K({includes:[],appends:[],fields:{},filters:{},sorts:p,page:r.value.page,limit:r.value.rowsPerPage,payload:null,...r.value}).query();return s.studentTopic.getStudentTopics(d)},{refetchOnWindowFocus:!1,...v}),V=N(()=>{var c;return((c=a.data.value)==null?void 0:c.data)||[]}),f=N(()=>{var c,h;return((h=(c=a.data.value)==null?void 0:c.pagination)==null?void 0:h.total)||0});return{...a,items:V,totalItems:f}}const ge={class:"d-flex flex-column flex-grow-1 h-full"},xe={class:"d-flex items-center"},ke={class:"mt-2 h-[calc(100%_-_45px)]"},Pe=U({__name:"student-topic",setup(r){const v=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Tên sinh viên",key:"ten"},{title:"Mã số",key:"maso"},{title:"Email",key:"email"},{title:"Lớp",key:"lop",width:"15%",minWidth:150},{title:"Nhóm",key:"nhom",width:"5%",minWidth:50},{title:"Giảng viên hướng dẫn",key:"gv",width:"20%",minWidth:200},{title:"",key:"action",width:100}],s=w({q:""}),a=w({page:1,rowsPerPage:100,sortBy:"-created_at",sortType:"asc"}),V=N(()=>({...a.value}));C();const{items:f,totalItems:c,isLoading:h,refetch:p}=ye(V);return(d,e)=>(k(),b("div",ge,[e[8]||(e[8]=m("div",{class:"text-lg font-bold text-uppercase"},"Quản lý sinh viên khóa luận",-1)),t(Y,{class:"px-3 py-2 h-full",color:"white",variant:"flat"},{default:n(()=>[m("div",xe,[t(z,{"min-width":"600",width:"60%"},{activator:n(({props:l})=>[t($,M({color:"success",size:"small"},l),{default:n(()=>[t(S,null,{default:n(()=>e[2]||(e[2]=[x("mdi-plus")])),_:1}),e[3]||(e[3]=m("span",null,"Import",-1))]),_:2},1040)]),default:n(({isActive:l})=>[t(pe,{onCancel:y=>l.value=!1},null,8,["onCancel"])]),_:1}),t(g,{modelValue:i(s).q,"onUpdate:modelValue":e[0]||(e[0]=l=>i(s).q=l),class:"h-[24px] w-[250px] ml-2",clearable:"",density:"compact",placeholder:"Tên/Mã số sinh viên","prepend-inner-icon":"mdi-magnify",variant:"plain"},null,8,["modelValue"]),t(j),t(z,{"min-width":"400",width:"40%"},{activator:n(({props:l})=>[t($,M({color:"success",size:"small"},l),{default:n(()=>[t(S,null,{default:n(()=>e[4]||(e[4]=[x("mdi-plus")])),_:1}),e[5]||(e[5]=m("span",null,"Thêm sinh viên",-1))]),_:2},1040)]),default:n(({isActive:l})=>[t(ce,{onCancel:y=>l.value=!1,onSuccess:i(p)},null,8,["onCancel","onSuccess"])]),_:1}),t($,{icon:"",size:"x-small",variant:"text",onClick:e[1]||(e[1]=l=>i(p)())},{default:n(()=>[t(S,null,{default:n(()=>e[6]||(e[6]=[x("mdi-refresh")])),_:1})]),_:1})]),m("div",ke,[t(Z,{class:"h-full","fixed-header":"",headers:v,"hide-default-footer":"",items:i(f),"items-per-page":1e3,loading:i(h)},{"item.index":n(({index:l})=>[m("span",null,T(l+1),1)]),"item.nhom":n(({item:l})=>{var y;return[m("span",null,T((y=l.studentTopic[0])==null?void 0:y.group_id),1)]}),"item.gv":n(({item:l})=>{var y,q,_,o;return[m("span",null,T((q=(y=l.studentTopic[0])==null?void 0:y.topic)==null?void 0:q.teacher.hodem)+" "+T((o=(_=l.studentTopic[0])==null?void 0:_.topic)==null?void 0:o.teacher.ten),1)]}),"item.ten":n(({item:l})=>[m("span",null,T(l.hodem+" "+l.ten),1)]),"item.ngay_sinh":n(({item:l})=>[m("span",null,T(i(X)(new Date(l.ngay_sinh),"dd/MM/yyyy")),1)]),"item.action":n(({item:l})=>[t(z,{"min-width":"400",width:"40%"},{activator:n(({props:y})=>[t($,M(y,{color:"success",icon:"",size:"small",variant:"text"}),{default:n(()=>[t(S,null,{default:n(()=>e[7]||(e[7]=[x("mdi-pencil")])),_:1})]),_:2},1040)]),default:n(({isActive:y})=>[t(fe,{"student-topic":l,onCancel:q=>y.value=!1},null,8,["student-topic","onCancel"])]),_:2},1024),t(ve,{"student-topic":l,onSuccess:i(p)},null,8,["student-topic","onSuccess"])]),_:1},8,["items","loading"])])]),_:1})]))}});export{Pe as default};
