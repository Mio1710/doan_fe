import{_ as y}from"./ToVgvsDd.js";import{V as A,s as F}from"./CmskZ_64.js";import{d as U,r as $,a as C,P as W,t as k,L as D,A as s,M as l,v as w,x as m,z as t,B as x,V as b,y as T,N as E,R as _,Q as z,O as R,i as N,S as j,W as X}from"./sjUhAvvQ.js";import{r as J,u as I}from"./DG2X6oDA.js";import{_ as L}from"./BchFbIxZ.js";import{V as G}from"./BHfJFfMX.js";import{V as M}from"./DMZBU9fF.js";import{P as K,_ as O}from"./DZ_F3gcz.js";import{V as Y}from"./Do9P-qNa.js";import{V as Z}from"./Cx9EZ3Dw.js";import"./tlA2e_jv.js";import"./D6BUiA2n.js";import"./C5tCWyF6.js";import"./BHFGkcei.js";import"./BRtmg2Ro.js";import"./Cw6M3Hk1.js";const ee={key:0},te={class:"d-flex items-center"},le={key:0},ne={key:1},ie={key:0},se={key:1},oe={key:0},ae={key:1},ue={key:1},de={class:"mt-4"},re={class:"max-w-[520px] ma-auto d-flex"},me={class:"d-none"},pe=U({__name:"ImportStudentTopic",emits:["cancel","success"],setup(r,{emit:v}){const i=$(null),{$api:o,$toast:g}=C(),f=v,c=W(),h=$(!1),p=$(!1),d=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Sinh viên",key:"ten",width:"20%",minWidth:200},{title:"Mã số",key:"maso",minWidth:100},{title:"Email",key:"email",minWidth:100},{title:"Ngày sinh",key:"ngay_sinh",minWidth:100},{title:"Lớp",key:"lop",width:"15%",minWidth:100,align:"center"}],e=()=>{o.studentTopic.importStudentTopic(F.serialize({file:i.value})).then(S=>{if(S.size>2106){g.error("Dữ liệu không hợp lệ, vui lòng kiểm tra lại!");const a=URL.createObjectURL(new Blob([S])),u=document.createElement("a");u.href=a,u.setAttribute("download","error_student.xlsx"),document.body.appendChild(u),u.click()}else g.success("Import sinh viên thành công");c.invalidateQueries("student-topic"),f("cancel"),f("success")}).finally(()=>{p.value=!1})},n=["STT","maso","hodem","ten","ngay_sinh","lop","email"],V=$([]),q=()=>{const S=new FileReader;if(i.value){if(console.log("check file",i,i.value),i.value.size>5*1024*1024){g.error("File phải nhỏ hơn 5MB");return}S.onload=a=>{var u;if(console.log("check event",a.target),(u=a.target)!=null&&u.result){const H=J(a.target.result,{type:"binary",cellDates:!0}),P=H.Sheets[H.SheetNames[0]],B=I.sheet_to_json(P,{header:1})[0];if(JSON.stringify(B)!==JSON.stringify(n)){g.error("File không đúng định dạng");return}const Q=I.sheet_to_json(P);h.value=!0,V.value=Q}},S.readAsBinaryString(i.value)}};return(S,a)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy","hide-submit":!l(h),title:"Import sinh viên khóa luận",onCancel:a[2]||(a[2]=u=>f("cancel")),onSubmit:e},{default:s(()=>[l(h)?(k(),w("div",ee,[m("div",te,[t(b,{class:"ma-2",color:"error"},{default:s(()=>a[3]||(a[3]=[x("mdi-alert-circle")])),_:1}),a[4]||(a[4]=m("span",null,"Dữ liệu không hợp lệ có thể không được lưu!",-1))]),t(G,{headers:d,height:"400","item-value":"name",items:l(V)},{"item.index":s(({index:u})=>[m("span",null,T(u+1),1)]),"item.ten":s(({item:u})=>[u.hodem&&u.ten?(k(),w("span",le,T(u.hodem+" "+u.ten),1)):(k(),w("span",ne,[t(b,{color:"error"},{default:s(()=>a[5]||(a[5]=[x("mdi-alert-circle")])),_:1})]))]),"item.maso":s(({item:u})=>[u.maso?(k(),w("span",ie,T(u.maso),1)):(k(),w("span",se,[t(b,{color:"error"},{default:s(()=>a[6]||(a[6]=[x("mdi-alert-circle")])),_:1})]))]),"item.email":s(({item:u})=>[u.email?(k(),w("span",oe,T(u.email),1)):(k(),w("span",ae,[t(b,{color:"error"},{default:s(()=>a[7]||(a[7]=[x("mdi-alert-circle")])),_:1})]))]),_:1},8,["items"])])):(k(),w("div",ue,[a[9]||(a[9]=m("div",{class:"mt-5"},[x(" Tải xuống mẫu import dữ liệu: "),m("a",{download:"",href:"/files/student_topic_template.xlsx",target:"_blank"},"download")],-1)),m("div",de,[m("div",re,[t(A,{modelValue:l(i),"onUpdate:modelValue":a[0]||(a[0]=u=>E(i)?i.value=u:null),accept:".xlsx",class:"w-full mr-4",label:"File dữ liệu",variant:"outlined"},null,8,["modelValue"]),m("div",me,[t(y,{modelValue:l(i),"onUpdate:modelValue":a[1]||(a[1]=u=>E(i)?i.value=u:null),rules:"required"},null,8,["modelValue"])]),t(_,{color:"success",disabled:!l(i),onClick:q},{default:s(()=>a[8]||(a[8]=[x("Xem trước")])),_:1},8,["disabled"])])])]))]),_:1},8,["hide-submit"]))}}),ce=U({__name:"CreateStudentTopic",emits:["cancel","success"],setup(r,{emit:v}){const i=$({hodem:"",ten:"",email:"",maso:"",lop:"",phone:""}),{$api:o,$toast:g}=C(),f=v,c=W(),h=()=>{o.admin.createStudentTopic(i.value).then(()=>{g.success("Thêm mới sinh viên khóa luận thành công"),c.invalidateQueries("student-topic"),f("success"),f("cancel")})};return(p,d)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy",title:"Thêm mới sinh viên khóa luận",onCancel:d[6]||(d[6]=e=>f("cancel")),onSubmit:h},{default:s(()=>[t(y,{modelValue:l(i).hodem,"onUpdate:modelValue":d[0]||(d[0]=e=>l(i).hodem=e),label:"Họ đệm",name:"Họ đệm",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(i).ten,"onUpdate:modelValue":d[1]||(d[1]=e=>l(i).ten=e),label:"Tên sinh viên",name:"Tên sinh viên",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(i).maso,"onUpdate:modelValue":d[2]||(d[2]=e=>l(i).maso=e),label:"Mã số",name:"Mã số",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(i).email,"onUpdate:modelValue":d[3]||(d[3]=e=>l(i).email=e),label:"Email",name:"Email",rules:"required|email"},null,8,["modelValue"]),t(y,{modelValue:l(i).lop,"onUpdate:modelValue":d[4]||(d[4]=e=>l(i).lop=e),label:"Lớp",name:"Lớp",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(i).phone,"onUpdate:modelValue":d[5]||(d[5]=e=>l(i).phone=e),label:"Số điện thoại",name:"Số điện thoại"},null,8,["modelValue"])]),_:1}))}}),fe=U({__name:"UpdateStudentTopic",props:{studentTopic:{type:Object,required:!0}},emits:["cancel","success"],setup(r,{emit:v}){const o=$({...r.studentTopic}),{$api:g,$toast:f}=C(),c=v,h=W(),p=()=>{g.admin.updateStudentTopic(o.value.id,o.value).then(()=>{f.success("Cập nhật sinh viên khóa luận thành công"),h.invalidateQueries("student-topic"),c("success"),c("cancel")})};return(d,e)=>(k(),D(L,{"can-cancel":"","cancel-text":"Hủy",title:"Cập nhật sinh viên khóa luận",onCancel:e[6]||(e[6]=n=>c("cancel")),onSubmit:p},{default:s(()=>[t(y,{modelValue:l(o).hodem,"onUpdate:modelValue":e[0]||(e[0]=n=>l(o).hodem=n),label:"Họ đệm",name:"Họ đệm",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(o).ten,"onUpdate:modelValue":e[1]||(e[1]=n=>l(o).ten=n),label:"Tên sinh viên",name:"Tên sinh viên",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(o).maso,"onUpdate:modelValue":e[2]||(e[2]=n=>l(o).maso=n),label:"Mã số",name:"Mã số",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(o).email,"onUpdate:modelValue":e[3]||(e[3]=n=>l(o).email=n),label:"Email",name:"Email",rules:"required|email"},null,8,["modelValue"]),t(y,{modelValue:l(o).lop,"onUpdate:modelValue":e[4]||(e[4]=n=>l(o).lop=n),label:"Lớp",name:"Lớp",rules:"required"},null,8,["modelValue"]),t(y,{modelValue:l(o).phone,"onUpdate:modelValue":e[5]||(e[5]=n=>l(o).phone=n),label:"Số điện thoại",name:"Số điện thoại"},null,8,["modelValue"])]),_:1}))}}),he={class:"text-center text-warning"},ve=U({__name:"DeleteStudentTopicConfirmDialog",props:{studentTopic:{type:Object,required:!0}},emits:["success"],setup(r,{emit:v}){const i=r,o=v,{$api:g,$toast:f}=C(),c=()=>{g.admin.deleteStudentTopic(i.studentTopic.id).then(()=>{f.success("Xóa sinh viên khóa luận thành công"),o("success")})};return(h,p)=>(k(),D(M,{"min-width":"400",width:"40%"},{activator:s(({props:d})=>[t(_,z(d,{color:"error",icon:"",size:"small",variant:"text"}),{default:s(()=>[t(b,null,{default:s(()=>p[0]||(p[0]=[x("mdi-trash-can")])),_:1})]),_:2},1040)]),default:s(({isActive:d})=>[t(L,{"can-cancel":"","cancel-text":"Hủy","submit-text":"Xóa",title:"Xác nhận xóa sinh viên khóa luận",onCancel:e=>d.value=!1,onSubmit:c},{default:s(()=>[m("div",he,[m("span",null,[t(b,null,{default:s(()=>p[1]||(p[1]=[x("mdi-warning")])),_:1}),p[2]||(p[2]=x(" Xóa sinh viên ")),m("strong",null,T(r.studentTopic.hodem)+" "+T(r.studentTopic.ten)+" - "+T(r.studentTopic.maso),1),p[3]||(p[3]=x(" khỏi hệ thống? "))])])]),_:2},1032,["onCancel"])]),_:1}))}});function ge(r,v){return r?Array.isArray(r)?O.map(O.zip(r,v),([i,o])=>o==="desc"?`-${i}`:i):[v==="desc"?`-${r}`:r]:[]}function Ve(r,v){const{$api:i}=C(),o=R(["student-topic",r],()=>{const{sortBy:c,sortType:h}=r.value,p=ge(c,h),d=new K({includes:[],appends:[],fields:{},filters:{},sorts:p,page:r.value.page,limit:r.value.rowsPerPage,payload:null,...r.value}).query();return i.studentTopic.getStudentTopics(d)},{refetchOnWindowFocus:!1,...v}),g=N(()=>{var c;return((c=o.data.value)==null?void 0:c.data)||[]}),f=N(()=>{var c,h;return((h=(c=o.data.value)==null?void 0:c.pagination)==null?void 0:h.total)||0});return{...o,items:g,totalItems:f}}const ye={class:"d-flex flex-column flex-grow-1 h-full"},xe={class:"d-flex items-center"},ke={class:"mt-2 h-[calc(100%_-_45px)]"},Pe=U({__name:"student-topic",setup(r){const v=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Tên sinh viên",key:"ten"},{title:"Mã số",key:"maso"},{title:"Email",key:"email"},{title:"Lớp",key:"lop",width:"15%",minWidth:150},{title:"Nhóm",key:"nhom",width:"5%",minWidth:50},{title:"Giảng viên hướng dẫn",key:"gv",width:"20%",minWidth:200},{title:"",key:"action",width:100}],i=$({q:""}),o=$({page:1,rowsPerPage:100,sortBy:"-created_at",sortType:"asc"}),g=N(()=>({...o.value,filters:i.value}));C();const{items:f,totalItems:c,isLoading:h,refetch:p}=Ve(g);return(d,e)=>(k(),w("div",ye,[e[10]||(e[10]=m("div",{class:"text-lg font-bold text-uppercase"},"Quản lý sinh viên khóa luận",-1)),t(Y,{class:"px-3 py-2 h-full",color:"white",variant:"flat"},{default:s(()=>[m("div",xe,[t(M,{"min-width":"600",width:"60%"},{activator:s(({props:n})=>[t(_,z({color:"success",size:"small"},n),{default:s(()=>[t(b,null,{default:s(()=>e[4]||(e[4]=[x("mdi-plus")])),_:1}),e[5]||(e[5]=m("span",null,"Import",-1))]),_:2},1040)]),default:s(({isActive:n})=>[t(pe,{onCancel:V=>n.value=!1},null,8,["onCancel"])]),_:1}),t(y,{modelValue:l(i).q,"onUpdate:modelValue":e[0]||(e[0]=n=>l(i).q=n),class:"h-[24px] w-[250px] ml-2",clearable:"",density:"compact",placeholder:"Tên/Mã số sinh viên","prepend-inner-icon":"mdi-magnify",variant:"plain"},null,8,["modelValue"]),t(j),t(_,{class:"mr-2",disabled:l(o).page<=1,icon:"mdi-chevron-left",size:"x-small",variant:"outlined",onClick:e[1]||(e[1]=n=>l(o).page--)},null,8,["disabled"]),t(_,{class:"mr-2",disabled:l(f).length<100,icon:"mdi-chevron-right",size:"x-small",variant:"outlined",onClick:e[2]||(e[2]=n=>l(o).page++)},null,8,["disabled"]),t(M,{"min-width":"400",width:"40%"},{activator:s(({props:n})=>[t(_,z({color:"success",size:"small"},n),{default:s(()=>[t(b,null,{default:s(()=>e[6]||(e[6]=[x("mdi-plus")])),_:1}),e[7]||(e[7]=m("span",null,"Thêm sinh viên",-1))]),_:2},1040)]),default:s(({isActive:n})=>[t(ce,{onCancel:V=>n.value=!1,onSuccess:l(p)},null,8,["onCancel","onSuccess"])]),_:1}),t(_,{icon:"",size:"x-small",variant:"text",onClick:e[3]||(e[3]=n=>l(p)())},{default:s(()=>[t(b,null,{default:s(()=>e[8]||(e[8]=[x("mdi-refresh")])),_:1})]),_:1})]),m("div",ke,[t(Z,{class:"h-full","fixed-header":"",headers:v,"hide-default-footer":"",items:l(f),"items-per-page":1e3,loading:l(h)},{"item.index":s(({index:n})=>[m("span",null,T((l(o).page-1)*100+n+1),1)]),"item.nhom":s(({item:n})=>{var V;return[m("span",null,T((V=n.studentTopic[0])==null?void 0:V.group_id),1)]}),"item.gv":s(({item:n})=>{var V,q,S,a;return[m("span",null,T((q=(V=n.studentTopic[0])==null?void 0:V.topic)==null?void 0:q.teacher.hodem)+" "+T((a=(S=n.studentTopic[0])==null?void 0:S.topic)==null?void 0:a.teacher.ten),1)]}),"item.ten":s(({item:n})=>[m("span",null,T(n.hodem+" "+n.ten),1)]),"item.ngay_sinh":s(({item:n})=>[m("span",null,T(l(X)(new Date(n.ngay_sinh),"dd/MM/yyyy")),1)]),"item.action":s(({item:n})=>[t(M,{"min-width":"400",width:"40%"},{activator:s(({props:V})=>[t(_,z(V,{color:"success",icon:"",size:"small",variant:"text"}),{default:s(()=>[t(b,null,{default:s(()=>e[9]||(e[9]=[x("mdi-pencil")])),_:1})]),_:2},1040)]),default:s(({isActive:V})=>[t(fe,{"student-topic":n,onCancel:q=>V.value=!1},null,8,["student-topic","onCancel"])]),_:2},1024),t(ve,{"student-topic":n,onSuccess:l(p)},null,8,["student-topic","onSuccess"])]),_:1},8,["items","loading"])])]),_:1})]))}});export{Pe as default};
