import{V as z,s as B}from"./BBj7LUlG.js";import{a as R,O as j,i as E,d as S,r as y,P as A,t as c,L as T,A as u,z as o,M as l,v as C,B as x,V as I,y as V,T as L,N as O,x as a,R as N,$ as D,K as H,X as W,S as q,W as G}from"./CFiehynL.js";import{A as P}from"./nflsgOpI.js";import{_}from"./BjrrArms.js";import{V as K}from"./DBYuLB8G.js";import{V as X,a as J,b as Y,c as Z}from"./DuUUWDLQ.js";import"./D00urTNM.js";function ee(k,m){const{$api:f}=R(),d=j(["my-report-topic",k],()=>f.reportTopic.getReportTopics(),{refetchOnWindowFocus:!1,...m}),n=E(()=>{var i;return((i=d.data.value)==null?void 0:i.data)||{}});return{...d,items:n}}const le={key:0,class:"d-flex items-center gap-1 mb-1"},te={class:"w-full text-center mb-4"},oe=S({__name:"UpdateReportTopic",props:{item:{type:Object,required:!0}},emits:["success"],setup(k,{emit:m}){const f=k,d=y(!1),n=E(()=>({...f.item})),{$api:i,$toast:g}=R(),$=A(),U=m,v=y(null),F=()=>{n.value.file=v.value,i.reportTopic.updateReportTopic(n.value.id,B.serialize(n.value)).then(()=>{$.invalidateQueries("my-report-topic"),g.success("Cập nhật báo cáo thành công"),U("success")}).finally(()=>{d.value=!1})};return(w,s)=>(c(),T(P,null,{default:u(({handleSubmit:M})=>[o(_,{modelValue:l(n).week,"onUpdate:modelValue":s[0]||(s[0]=p=>l(n).week=p),class:"mb-5",label:"Tuần số",name:"Tuần số",rules:"required",type:"number"},null,8,["modelValue"]),l(n).file_name?(c(),C("div",le,[o(I,null,{default:u(()=>s[4]||(s[4]=[x("mdi-file-chart-outline")])),_:1}),x(" "+V(l(n).file_name),1)])):L("",!0),o(z,{modelValue:l(v),"onUpdate:modelValue":s[1]||(s[1]=p=>O(v)?v.value=p:null),accept:".doc,.docx,.pdf",clearable:"",label:"File báo cáo",name:"File báo cáo","prepend-icon":!1,"prepend-inner-icon":"mdi-paperclip","show-size":"",variant:"outlined",onChange:s[2]||(s[2]=p=>l(n).file_name="")},null,8,["modelValue"]),o(_,{modelValue:l(n).description,"onUpdate:modelValue":s[3]||(s[3]=p=>l(n).description=p),class:"mb-4",label:"Mô tả",name:"Mô tả",rules:"required",type:"textarea"},null,8,["modelValue"]),a("div",te,[o(N,{color:"success",loading:l(d),size:"small",onClick:p=>M(F)},{default:u(()=>s[5]||(s[5]=[x("Nộp báo cáo")])),_:2},1032,["loading","onClick"])])]),_:1}))}}),ne={class:"d-flex flex-column flex-grow-1 h-full"},se={class:"w-full text-center mb-4"},ae={key:2},ie={class:"d-flex w-full"},re={class:"d-flex items-center"},ue=["onClick"],ye=S({__name:"report-topic",setup(k){const m=y(!1),f=y(!1),d=y(null),n=()=>({id:null,week:"",description:"",file:null}),i=D(n()),{$api:g,$toast:$}=R(),U=A(),v=()=>{m.value=!0,g.reportTopic.createReportTopic(B.serialize(i)).then(()=>{U.invalidateQueries("my-report-topic"),Object.assign(i,n()),$.success("Nộp báo cáo thành công")}).finally(()=>{m.value=!1})},F=b=>{g.reportTopic.downloadReportTopic(b.file_key).then(e=>{const t=URL.createObjectURL(new Blob([e])),r=document.createElement("a");r.href=t,r.setAttribute("download",b.file_name),document.body.appendChild(r),r.click()})},w=y([]),{items:s,totalItems:M,isLoading:p,refetch:de}=ee(null,{retry:0}),h=b=>{d.value=b,console.log("itemUpdate",d.value,b),f.value=!0};return(b,e)=>(c(),C("div",ne,[e[9]||(e[9]=a("div",{class:"text-lg font-bold text-uppercase"},"Báo cáo tiến độ đề tài đồ án",-1)),o(K,{class:"pa-3 h-full overflow-y-scroll",color:"white",variant:"flat"},{default:u(()=>[l(f)?(c(),T(oe,{key:0,item:l(d),onSuccess:e[0]||(e[0]=t=>f.value=!1)},null,8,["item"])):(c(),T(P,{key:1},{default:u(({handleSubmit:t})=>[o(_,{modelValue:l(i).week,"onUpdate:modelValue":e[1]||(e[1]=r=>l(i).week=r),class:"mb-5",label:"Tuần số",name:"Tuần số",rules:"required",type:"number"},null,8,["modelValue"]),o(z,{modelValue:l(i).file,"onUpdate:modelValue":e[2]||(e[2]=r=>l(i).file=r),accept:".doc,.docx,.pdf",clearable:"",label:"File báo cáo",name:"File báo cáo","prepend-icon":!1,"prepend-inner-icon":"mdi-paperclip","show-size":"",variant:"outlined"},null,8,["modelValue"]),o(_,{modelValue:l(i).description,"onUpdate:modelValue":e[3]||(e[3]=r=>l(i).description=r),class:"mb-4",label:"Mô tả",name:"Mô tả",rules:"required",type:"textarea"},null,8,["modelValue"]),a("div",se,[o(N,{color:"success",loading:l(m),size:"small",onClick:r=>t(v)},{default:u(()=>e[5]||(e[5]=[x("Nộp báo cáo")])),_:2},1032,["loading","onClick"])])]),_:1})),l(s)?(c(),C("div",ae,[o(X,{modelValue:l(w),"onUpdate:modelValue":e[4]||(e[4]=t=>O(w)?w.value=t:null),multiple:""},{default:u(()=>[(c(!0),C(H,null,W(l(s),(t,r)=>(c(),T(J,{key:r},{default:u(()=>[o(Y,null,{default:u(()=>[a("div",ie,[a("span",null,"Tuần "+V(t.week),1),o(q),a("div",null,"Nộp lúc: "+V(l(G)(new Date(t==null?void 0:t.created_at),"dd/MM/yyyy HH:mm")),1)])]),_:2},1024),o(Z,null,{default:u(()=>[a("div",re,[a("div",null,[e[6]||(e[6]=a("span",{class:"font-weight-bold"},"File báo cáo:",-1)),a("span",{class:"cursor-pointer underline text-blue-400 ml-2",onClick:Q=>F(t)},V(t.file_name),9,ue)]),o(q),o(N,{color:"success",height:"20",icon:"mdi-pencil",size:"small",variant:"plain",onClick:Q=>h(t)},null,8,["onClick"])]),a("div",null,[a("div",null,[e[7]||(e[7]=a("span",{class:"font-weight-bold"},"Mô tả:",-1)),x(" "+V(t.description),1)]),e[8]||(e[8]=a("div",{class:"font-weight-bold"},"Nhận xét của giảng viên:",-1)),a("div",null,V(t.comment),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])])):L("",!0)]),_:1})]))}});export{ye as default};
