import{d as $,r as W,i as P,a as V,P as q,t as u,L as v,A as o,x as d,y as p,R as S,B as w,M as h,v as x,z as m,S as N,Q as G,K as I,a0 as B,a3 as z,a5 as D,Z as L,N as O,O as Q,T as X}from"./CFiehynL.js";import{u as F}from"./BMYoRmek.js";import{V as R}from"./CZ9s_aoN.js";import{_ as K}from"./1adOK-vi.js";import{V as Y}from"./DnFUZBxv.js";import{m as j,V as M}from"./BBJD5s-R.js";import{V as E}from"./DBYuLB8G.js";import"./DZ_F3gcz.js";import"./CISklGHC.js";import"./CN8nOB4F.js";import"./VaKneH-D.js";import"./D00urTNM.js";import"./nflsgOpI.js";const U=["innerHTML"],Z=$({__name:"TopicRegister",props:{topicId:{type:Number,default:null}},emits:["success","viewAll"],setup(i,{emit:r}){const l=W({page:1,rowsPerPage:100,sortBy:"-created_at",sortType:"asc"}),c=P(()=>({...l.value,filters:{viewAll:!0}})),{$api:e,$toast:n}=V(),t=q(),{items:a,totalItems:f,isLoading:b,refetch:_}=F(c),C=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"Tên đề tài",key:"ten",width:"20%",minWidth:200},{title:"Mô tả",key:"description",width:"30%",minWidth:250},{title:"Yêu cầu",key:"requirement",width:"15%",minWidth:200},{title:"Kiến thức kỹ năng",key:"knowledge",width:"15%",minWidth:200},{title:"GVHD",key:"gv",width:"10%",minWidth:100},{title:"Số lượng",key:"numberStudent",minWidth:10},{title:"",key:"action",width:30,align:"center"}],T=r,y=k=>{e.studentTopic.registerTopic(k.id).then(()=>{T("success"),t.invalidateQueries("registed-topic"),n.success("Đăng ký đề tài thành công")})};return(k,g)=>(u(),v(R,{class:"h-full","fixed-header":"",headers:C,"hide-default-footer":"",items:h(a),"items-per-page":h(l).rowsPerPage},{"item.index":o(({index:s})=>[d("span",null,p(s+1),1)]),"item.name":o(({item:s})=>[d("span",{innerHTML:s.name},null,8,U)]),"item.numberStudent":o(({item:s})=>[d("span",null,p(s.currentNumberStudent)+"/"+p(s==null?void 0:s.numberStudent),1)]),"item.gv":o(({item:s})=>{var A,H;return[d("span",null,p((A=s==null?void 0:s.teacher)==null?void 0:A.hodem)+" "+p((H=s==null?void 0:s.teacher)==null?void 0:H.ten),1)]}),"item.action":o(({item:s})=>[s.id==i.topicId?(u(),v(S,{key:0,color:"primary",size:"x-small",onClick:g[0]||(g[0]=A=>T("viewAll"))},{default:o(()=>g[1]||(g[1]=[w("Xem")])),_:1})):(u(),v(S,{key:1,color:"success",disabled:i.topicId||s.currentNumberStudent>=s.numberStudent,size:"x-small",onClick:A=>y(s)},{default:o(()=>g[2]||(g[2]=[w(" Đăng ký ")])),_:2},1032,["disabled","onClick"]))]),_:1},8,["items","items-per-page"]))}}),J=$({__name:"CancelTopic",props:{partner:{type:Array,default:()=>[]}},emits:["cancel","success"],setup(i,{emit:r}){const{$api:l,$toast:c}=V(),e=r,n=q(),t=()=>{l.studentTopic.cancelTopic().then(()=>{c.success("Hủy đề tài thành công"),n.invalidateQueries("topic"),e("success"),e("cancel")})};return(a,f)=>(u(),v(K,{"can-cancel":"","submit-text":"Xác nhận",title:"Xác nhận hủy đề tài",onCancel:f[0]||(f[0]=b=>e("cancel")),onSubmit:t},{default:o(()=>f[1]||(f[1]=[d("div",{class:"font-bold text-center text-warning"},"Nếu hủy đề tài bạn sẽ đồng thời hủy nhóm?",-1),d("div",{class:"text-center font-italic"},"Hành động không thể hoàn tác!",-1)])),_:1}))}}),tt={class:"d-flex py-2 bottom-border"},et=["innerHTML"],it=$({__name:"TopicRegisted",props:{items:{type:Array,required:!0},partner:{type:Array,default:()=>[]},numberStudent:{type:Number,default:0}},emits:["refetch","viewAll"],setup(i,{emit:r}){V();const l=r,c=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"Tên đề tài",key:"ten",width:"20%",minWidth:150},{title:"Mô tả",key:"description",width:"35%",minWidth:300},{title:"Yêu cầu",key:"requirement",width:"20%",minWidth:200},{title:"Kiến thức kỹ năng",key:"knowledge",width:"15%",minWidth:100},{title:"Giảng viên HD",key:"gvhd",width:"10%",minWidth:100},{title:"Số lượng",key:"numberStudent",align:"center"}];return(e,n)=>(u(),x(I,null,[d("div",tt,[n[4]||(n[4]=d("div",{class:"text-lg"},"Đề tài đã đăng ký thành công",-1)),m(N),m(Y,{"min-width":"400",width:"40%"},{activator:o(({props:t})=>[m(S,G({color:"error",size:"small"},t),{default:o(()=>n[2]||(n[2]=[w("Hủy đề tài")])),_:2},1040)]),default:o(({isActive:t})=>[m(J,{partner:i.partner,onCancel:a=>t.value=!1,onSuccess:n[0]||(n[0]=a=>l("refetch"))},null,8,["partner","onCancel"])]),_:1}),m(S,{class:"ml-2",color:"primary",size:"small",onClick:n[1]||(n[1]=t=>l("viewAll"))},{default:o(()=>n[3]||(n[3]=[w("Xem tất cả đề tài")])),_:1})]),m(R,{class:"mt-2",headers:c,"hide-default-footer":"",items:i.items},{"item.index":o(({index:t})=>[d("span",null,p(t+1),1)]),"item.name":o(({item:t})=>[d("span",{innerHTML:t.name},null,8,et)]),"item.gvhd":o(({item:t})=>{var a,f;return[w(p((a=t==null?void 0:t.teacher)==null?void 0:a.hodem)+" "+p((f=t==null?void 0:t.teacher)==null?void 0:f.ten),1)]}),"item.numberStudent":o(({item:t})=>[w(p(i.numberStudent)+"/"+p(t==null?void 0:t.numberStudent),1)]),_:1},8,["items"])],64))}}),nt=B({...j({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),st=z()({name:"VRadio",props:nt(),setup(i,r){let{slots:l}=r;return D(()=>{const c=M.filterProps(i);return m(M,G(c,{class:["v-radio",i.class],style:i.style,type:"radio"}),l)}),{}}}),ot={class:"d-flex py-2 bottom-border"},lt={class:"text-lg"},rt={key:1},at=$({__name:"StudentRegisted",props:{items:{type:Array,required:!0},topicId:{type:Number,required:!0}},emits:["refetch"],setup(i,{emit:r}){const l=i,c=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"MASV",key:"maso",width:"20%",minWidth:150},{title:"HỌ ĐỆM",key:"hodem",width:"25%",minWidth:200},{title:"TÊN",key:"ten",width:"15%",minWidth:100},{title:"LỚP",key:"lop",width:"20%",minWidth:150},{title:"NHÓM",key:"nhom",width:"10%",minWidth:100},{title:"TẠO NHÓM",key:"action",minWidth:50,align:"center"}],e=W(null),n=L(),{$api:t,$toast:a}=V(),f=r,b=C=>{e.value=C.id},_=()=>{t.studentTopic.createGroup({partner_id:e.value,topic_id:l.topicId}).then(()=>{f("refetch"),a.success("Tạo nhóm thành công")}).finally(()=>f("refetch"))};return(C,T)=>(u(),x("div",null,[d("div",ot,[d("div",lt,"Danh sách sinh viên đăng ký cùng đề tài "+p(h(e)),1),m(N),m(S,{color:"success",disabled:!h(e),size:"small",onClick:_},{default:o(()=>T[1]||(T[1]=[w("Tạo")])),_:1},8,["disabled"])]),m(R,{class:"mt-2",headers:c,"hide-default-footer":"",items:i.items},{"item.index":o(({index:y})=>[d("span",null,p(y+1),1)]),"item.nhom":o(({item:y})=>{var k;return[d("span",null,p((k=y.studentTopic[0])==null?void 0:k.group_id),1)]}),"item.action":o(({item:y})=>{var k,g;return[!y.nhom&&((k=h(n).data)==null?void 0:k.value.id)!=y.id&&!((g=y.studentTopic[0])!=null&&g.group_id)?(u(),v(st,{key:0,modelValue:h(e),"onUpdate:modelValue":T[0]||(T[0]=s=>O(e)?e.value=s:null),"false-value":!h(e),value:y.id,onClick:s=>b(y)},null,8,["modelValue","false-value","value","onClick"])):(u(),x("div",rt))]}),_:1},8,["items"])]))}}),dt={class:"d-flex py-2 bottom-border"},ct={class:"text-lg"},ut=$({__name:"PartnerRegisted",props:{items:{type:Array,required:!0},topicId:{type:Number,required:!0}},emits:["refetch"],setup(i,{emit:r}){const l=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"MASV",key:"maso",width:"20%",minWidth:150},{title:"HỌ ĐỆM",key:"hodem",width:"25%",minWidth:200},{title:"TÊN",key:"ten"},{title:"LỚP",key:"lop",width:"20%",minWidth:150}],c=W(null);L();const{$api:e,$toast:n}=V(),t=r,a=()=>{e.studentTopic.cancelGroup().then(()=>{t("refetch"),n.success("Tạo nhóm thành công")})};return(f,b)=>(u(),x("div",null,[d("div",dt,[d("div",ct,"Danh sách sinh viên nhóm "+p(h(c)),1),m(N),m(S,{color:"error",size:"small",onClick:a},{default:o(()=>b[0]||(b[0]=[w("Hủy nhóm")])),_:1})]),m(R,{class:"mt-2",headers:l,"hide-default-footer":"",items:i.items},{"item.index":o(({index:_})=>[d("span",null,p(_+1),1)]),_:1},8,["items"])]))}}),mt=$({__name:"TopicRegistedSuccess",props:{items:{type:Object,required:!0}},emits:["refetch","viewAll"],setup(i,{emit:r}){const l=r;return(c,e)=>{var n,t;return u(),x(I,null,[m(it,{items:[i.items.topic.topic],"number-student":(n=i.items)==null?void 0:n.students.length,partner:i.items.partner,onRefetch:e[0]||(e[0]=a=>l("refetch")),onViewAll:e[1]||(e[1]=a=>l("viewAll"))},null,8,["items","number-student","partner"]),((t=i.items.partner)==null?void 0:t.length)>1?(u(),v(ut,{key:0,class:"mt-6",items:i.items.partner,"topic-id":i.items.topic.topic_id,onRefetch:e[2]||(e[2]=a=>l("refetch"))},null,8,["items","topic-id"])):(u(),v(at,{key:1,class:"mt-6",items:i.items.students,"topic-id":i.items.topic.topic_id,onRefetch:e[3]||(e[3]=a=>l("refetch"))},null,8,["items","topic-id"]))],64)}}});function pt(i,r){const{$api:l}=V(),c=Q(["registed-topic",i],()=>l.studentTopic.getRegistedTopic(),{refetchOnWindowFocus:!1,...r}),e=P(()=>{var n;return((n=c.data.value)==null?void 0:n.data)||[]});return{...c,items:e}}const ht={class:"d-flex flex-column flex-grow-1 h-full"},ft={key:0,class:"h-full"},At=$({__name:"index",setup(i){const{items:r,isLoading:l,refetch:c}=pt(null,{retry:0}),e=W(!1);return(n,t)=>(u(),x("div",ht,[t[3]||(t[3]=d("div",{class:"text-lg font-bold text-uppercase"},"Đăng ký đề tài đồ án",-1)),m(E,{class:"pa-3 h-full",color:"white",variant:"flat"},{default:o(()=>[h(r).topic?(u(),x("div",ft,[!h(r).topic.topic_id||h(e)?(u(),v(Z,{key:0,"topic-id":h(r).topic.topic_id,onViewAll:t[0]||(t[0]=a=>e.value=!1)},null,8,["topic-id"])):(u(),v(mt,{key:1,items:h(r),onRefetch:t[1]||(t[1]=a=>h(c)()),onViewAll:t[2]||(t[2]=a=>e.value=!0)},null,8,["items"]))])):X("",!0)]),_:1})]))}});export{At as default};
