import{d as D,r as y,a as N,S as F,i as T,t as k,L as R,A as s,M as a,v as P,z as n,K as z,X as M,N as U,T as O,x as e,y as m,R as S,W as Q,V as W,B as q,O as j,Z as G,Q as A,P as H}from"./BVcfHsMq.js";import{f as B}from"./D-3jeY6D.js";import{_ as K}from"./Dy0xatEG.js";import{u as X}from"./BAgfWLzm.js";import{_ as Z}from"./Onl3lASy.js";import{V as J,a as Y,b as ee,c as te}from"./COm35GLS.js";import{P as ne,_ as E}from"./DZ_F3gcz.js";import{V as se}from"./By37Y22m.js";import{V as I}from"./D5wmEg0D.js";import{V as le}from"./qJO9cKgh.js";import{V as ae}from"./DjNLs8i5.js";import{V as oe}from"./B2rIPphO.js";import"./DnMU98_p.js";import"./imMtzg40.js";import"./40oRFHCv.js";import"./CeBOzpmW.js";import"./DootYb4-.js";import"./C7lNElPM.js";const ie={key:0},re={class:"d-flex w-full"},de={class:"d-flex items-center"},ue=["onClick"],ce=D({__name:"ReportInternDetail",props:{item:{type:Object,required:!0}},emits:["cancel","success"],setup(o,{emit:p}){const f=o;y(!1);const{$api:l,$toast:_}=N(),x=F(),u=p,g=w=>{l.reportIntern.downloadReportIntern(w.file_key).then(r=>{const d=URL.createObjectURL(new Blob([r])),V=document.createElement("a");V.href=d,V.setAttribute("download",w.file_name),document.body.appendChild(V),V.click()})},h=y([]),v=f.item.student.id,i=T(()=>({filters:{studentId:v}})),{items:t,totalItems:c,isLoading:b,refetch:Ve}=X(i,{enabled:!!v}),C=y(""),L=w=>{l.teacher.commentStudentReportIntern(w.id,{comment:C.value}).then(()=>{_.success("Cập nhật nhận xét thành công"),x.invalidateQueries("student-report-topic")})};return(w,r)=>(k(),R(K,{"can-cancel":"","cancel-text":"Đóng","hide-submit":"",title:"Báo cáo quá trình thực tập của sinh viên:",onCancel:r[2]||(r[2]=d=>u("cancel"))},{default:s(()=>[a(t)?(k(),P("div",ie,[n(J,{modelValue:a(h),"onUpdate:modelValue":r[1]||(r[1]=d=>U(h)?h.value=d:null),multiple:""},{default:s(()=>[(k(!0),P(z,null,M(a(t),(d,V)=>(k(),R(Y,{key:V},{default:s(()=>[n(ee,null,{default:s(()=>[e("div",re,[e("span",null,"Tuần "+m(d.week),1),n(S),e("div",null,"Nộp lúc: "+m(a(Q)(new Date(d==null?void 0:d.created_at),"dd/MM/yyyy HH:mm")),1)])]),_:2},1024),n(te,null,{default:s(()=>[e("div",de,[e("div",null,[r[3]||(r[3]=e("span",{class:"font-weight-bold"},"File báo cáo:",-1)),e("span",{class:"cursor-pointer underline text-blue-400 ml-2",onClick:$=>g(d)},m(d.file_name),9,ue)]),n(S),n(W,{color:"success",height:"20",icon:"mdi-content-save-check",size:"small",variant:"plain",onClick:$=>L(d)},null,8,["onClick"])]),e("div",null,[e("div",null,[r[4]||(r[4]=e("span",{class:"font-weight-bold"},"Mô tả:",-1)),q(" "+m(d.description),1)]),r[5]||(r[5]=e("div",{class:"font-weight-bold"},"Nhận xét của giảng viên:",-1)),e("div",null,[n(Z,{modelValue:a(C),"onUpdate:modelValue":r[0]||(r[0]=$=>U(C)?C.value=$:null),class:"mb-4",label:"Nhận xét của giảng viên","model-value":d.comment,name:"Nhận xét của giảng viên",rules:"required",type:"textarea"},null,8,["modelValue","model-value"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])])):O("",!0)]),_:1}))}});function me(o,p){return o?Array.isArray(o)?E.map(E.zip(o,p),([f,l])=>l==="desc"?`-${f}`:f):[p==="desc"?`-${o}`:o]:[]}function pe(o,p){const{$api:f}=N(),l=j(["teacher-intern",o],()=>{const{sortBy:u,sortType:g}=o.value,h=me(u,g);console.log("params",o.value);const v=new ne({includes:[],appends:[],fields:{},filters:{},sorts:h,page:o.value.page,limit:o.value.rowsPerPage,payload:null,...o.value}).query();return console.log("query",v),f.teacherIntern.getTeacherInterns(v)},{refetchOnWindowFocus:!1,...p}),_=T(()=>{var u;return((u=l.data.value)==null?void 0:u.data)||[]}),x=T(()=>{var u,g;return((g=(u=l.data.value)==null?void 0:u.pagination)==null?void 0:g.total)||0});return{...l,items:_,totalItems:x}}const fe={class:"d-flex flex-column flex-grow-1 h-full"},he={class:"d-flex"},ve={class:"d-flex"},ge={class:"mt-2 h-[calc(100%_-_30px)] overflow-y-hidden"},ye={class:"ma-2 text-center"},Ee=D({__name:"index",setup(o){y(!1),y("");const p=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Tên sinh viên",key:"student",width:"10%",minWidth:150},{title:"MSSV",key:"maso",width:"5%",minWidth:100},{title:"Tên công ty",key:"company_name",width:"15%",minWidth:150},{title:"Địa chỉ",key:"address",width:"20%",minWidth:150},{title:"Tên người hướng dẫn",key:"supervisor_name",width:"10%",minWidth:150},{title:"SĐT người hướng dẫn",key:"supervisor_phone",width:"10%",minWidth:100},{title:"Email người hướng dẫn",key:"supervisor_email",width:"10%",minWidth:150},{title:"Trạng thái",key:"status",width:"10%",minWidth:100,align:"center"},{title:"Chi tiết",key:"action",width:"10%",minWidth:100,sortable:!1,align:"center"}],f=y({page:1,rowsPerPage:25,sortBy:"-created_at",sortType:"asc"}),l=y({status:["pending","approved"]}),_=T(()=>({...f.value,filters:{viewAll:!0,...l.value}}));N(),G(),F();const{items:x,totalItems:u,isLoading:g,refetch:h}=pe(_);return(v,i)=>(k(),P("div",fe,[i[5]||(i[5]=e("div",{class:"text-lg font-bold text-uppercase"},"Danh sách thực tập",-1)),n(se,{class:"pa-3 h-full",color:"white",variant:"flat"},{default:s(()=>[e("div",he,[e("div",ve,[n(I,{modelValue:a(l).status,"onUpdate:modelValue":i[0]||(i[0]=t=>a(l).status=t),class:"mr-4",color:"warning",density:"compact","hide-details":"",label:" Chờ duyệt",value:"pending"},null,8,["modelValue"]),n(I,{modelValue:a(l).status,"onUpdate:modelValue":i[1]||(i[1]=t=>a(l).status=t),class:"mr-4",color:"success",density:"compact","hide-details":"",label:" Đã duyệt",value:"approved"},null,8,["modelValue"]),n(I,{modelValue:a(l).status,"onUpdate:modelValue":i[2]||(i[2]=t=>a(l).status=t),class:"mr-4",color:"error",density:"compact","hide-details":"",label:" Từ chối",value:"rejected"},null,8,["modelValue"])]),n(S),n(W,{color:"success",loading:v.isFetching,size:"small",onClick:a(h)},{default:s(()=>[n(A,null,{default:s(()=>i[3]||(i[3]=[q("mdi-refresh")])),_:1})]),_:1},8,["loading","onClick"])]),e("div",ge,[n(le,{class:"h-full","fixed-header":"",headers:p,"hide-default-footer":"",items:a(x),loading:v.isFetching},{"item.index":s(({index:t})=>[e("span",null,m(t+1),1)]),"item.student":s(({item:t})=>{var c,b;return[e("span",null,m((c=t.student)==null?void 0:c.hodem)+" "+m((b=t.student)==null?void 0:b.ten),1)]}),"item.maso":s(({item:t})=>{var c;return[e("span",null,m((c=t.student)==null?void 0:c.maso),1)]}),"item.status":s(({item:t})=>[e("div",ye,[n(ae,{color:a(B).statusColor(t.status),size:"small",variant:"flat"},{default:s(()=>[e("span",null,m(a(B).statusType(t.status)),1)]),_:2},1032,["color"])])]),"item.action":s(({item:t})=>[n(oe,{"min-width":"80",width:"80%"},{activator:s(({props:c})=>[n(W,H({rounded:"",variant:"text"},c),{default:s(()=>[n(A,{color:"success"},{default:s(()=>i[4]||(i[4]=[q("mdi-eye")])),_:1})]),_:2},1040)]),default:s(({isActive:c})=>[n(ce,{item:t,onCancel:b=>c.value=!1,onSuccess:a(h)},null,8,["item","onCancel","onSuccess"])]),_:2},1024)]),_:1},8,["items","loading"])])]),_:1})]))}});export{Ee as default};
