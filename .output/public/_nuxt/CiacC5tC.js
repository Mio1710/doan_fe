import{d as x,r as C,i as M,a as _,t as c,L as k,A as s,x as u,y as h,R as V,B as w,M as m,P as I,v as $,z as p,S as R,Q as P,K as q,a0 as L,a3 as B,a5 as z,Z as G,N as D,O,T as Q}from"./sjUhAvvQ.js";import{u as X}from"./DxV02YiU.js";import{V as W}from"./Cx9EZ3Dw.js";import{_ as F}from"./BchFbIxZ.js";import{V as K}from"./DMZBU9fF.js";import{m as Y,V as H}from"./Cw6M3Hk1.js";import{V as j}from"./Do9P-qNa.js";import"./DZ_F3gcz.js";import"./BHFGkcei.js";import"./BRtmg2Ro.js";import"./C5tCWyF6.js";import"./tlA2e_jv.js";import"./D6BUiA2n.js";const E=["innerHTML"],U=x({__name:"TopicRegister",props:{topicId:{type:Number,default:null}},emits:["success","viewAll"],setup(i,{emit:l}){const o=C({page:1,rowsPerPage:100,sortBy:"-created_at",sortType:"asc"}),d=M(()=>({...o.value,filters:{viewAll:!0}})),{$api:e,$toast:n}=_(),{items:t,totalItems:a,isLoading:v,refetch:f}=X(d),b=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"Tên đề tài",key:"ten",width:"20%",minWidth:200},{title:"Mô tả",key:"description",width:"30%",minWidth:250},{title:"Yêu cầu",key:"requirement",width:"15%",minWidth:200},{title:"Kiến thức kỹ năng",key:"knowledge",width:"15%",minWidth:200},{title:"GVHD",key:"gv",width:"10%",minWidth:100},{title:"Số lượng",key:"numberStudent",minWidth:10},{title:"",key:"action",width:30,align:"center"}],A=l,S=y=>{e.studentTopic.registerTopic(y.id).then(()=>{A("success"),n.success("Đăng ký đề tài thành công")})};return(y,g)=>(c(),k(W,{class:"h-full","fixed-header":"",headers:b,"hide-default-footer":"",items:m(t),"items-per-page":m(o).rowsPerPage},{"item.index":s(({index:r})=>[u("span",null,h(r+1),1)]),"item.name":s(({item:r})=>[u("span",{innerHTML:r.name},null,8,E)]),"item.numberStudent":s(({item:r})=>[u("span",null,h(r.currentNumberStudent)+"/"+h(r.numberStudent),1)]),"item.gv":s(({item:r})=>{var T,N;return[u("span",null,h((T=r==null?void 0:r.teacher)==null?void 0:T.hodem)+" "+h((N=r==null?void 0:r.teacher)==null?void 0:N.ten),1)]}),"item.action":s(({item:r})=>[r.id==i.topicId?(c(),k(V,{key:0,color:"primary",size:"x-small",onClick:g[0]||(g[0]=T=>A("viewAll"))},{default:s(()=>g[1]||(g[1]=[w("Xem")])),_:1})):(c(),k(V,{key:1,color:"success",disabled:i.topicId||r.currentNumberStudent>=r.numberStudent,size:"x-small",onClick:T=>S(r)},{default:s(()=>g[2]||(g[2]=[w(" Đăng ký ")])),_:2},1032,["disabled","onClick"]))]),_:1},8,["items","items-per-page"]))}}),Z=x({__name:"CancelTopic",props:{partner:{type:Array,default:()=>[]}},emits:["cancel","success"],setup(i,{emit:l}){const o=i,{$api:d,$toast:e}=_(),n=l,t=I(),a=()=>{const v=o.partner.map(f=>f.student_id);d.studentTopic.updateTopic({topic_id:null,partner_id:null,user_ids:v}).then(()=>{e.success("Hủy đề tài thành công"),t.invalidateQueries("topic"),n("success"),n("cancel")})};return(v,f)=>(c(),k(F,{"can-cancel":"","submit-text":"Xác nhận",title:"Xác nhận hủy đề tài",onCancel:f[0]||(f[0]=b=>n("cancel")),onSubmit:a},{default:s(()=>f[1]||(f[1]=[u("div",{class:"font-bold text-center text-warning"},"Nếu hủy đề tài bạn sẽ đồng thời hủy nhóm?",-1),u("div",{class:"text-center font-italic"},"Hành động không thể hoàn tác!",-1)])),_:1}))}}),J={class:"d-flex py-2 bottom-border"},tt=["innerHTML"],et=x({__name:"TopicRegisted",props:{items:{type:Array,required:!0},partner:{type:Array,default:()=>[]},numberStudent:{type:Number,default:0}},emits:["refetch","viewAll"],setup(i,{emit:l}){_();const o=l,d=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"Tên đề tài",key:"ten",width:"20%",minWidth:150},{title:"Mô tả",key:"description",width:"35%",minWidth:300},{title:"Yêu cầu",key:"requirement",width:"20%",minWidth:200},{title:"Kiến thức kỹ năng",key:"knowledge",width:"15%",minWidth:100},{title:"Giảng viên HD",key:"gvhd",width:"10%",minWidth:100},{title:"Số lượng",key:"numberStudent",align:"center"}];return(e,n)=>(c(),$(q,null,[u("div",J,[n[4]||(n[4]=u("div",{class:"text-lg"},"Đề tài đã đăng ký thành công",-1)),p(R),p(K,{"min-width":"400",width:"40%"},{activator:s(({props:t})=>[p(V,P({color:"error",size:"small"},t),{default:s(()=>n[2]||(n[2]=[w("Hủy đề tài")])),_:2},1040)]),default:s(({isActive:t})=>[p(Z,{partner:i.partner,onCancel:a=>t.value=!1,onSuccess:n[0]||(n[0]=a=>o("refetch"))},null,8,["partner","onCancel"])]),_:1}),p(V,{class:"ml-2",color:"primary",size:"small",onClick:n[1]||(n[1]=t=>o("viewAll"))},{default:s(()=>n[3]||(n[3]=[w("Xem tất cả đề tài")])),_:1})]),p(W,{class:"mt-2",headers:d,"hide-default-footer":"",items:i.items},{"item.index":s(({index:t})=>[u("span",null,h(t+1),1)]),"item.name":s(({item:t})=>[u("span",{innerHTML:t.name},null,8,tt)]),"item.gvhd":s(({item:t})=>{var a,v;return[w(h((a=t==null?void 0:t.teacher)==null?void 0:a.hodem)+" "+h((v=t==null?void 0:t.teacher)==null?void 0:v.ten),1)]}),"item.numberStudent":s(({item:t})=>[w(h(i.numberStudent)+"/"+h(t.numberStudent),1)]),_:1},8,["items"])],64))}}),it=L({...Y({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),nt=B()({name:"VRadio",props:it(),setup(i,l){let{slots:o}=l;return z(()=>{const d=H.filterProps(i);return p(H,P(d,{class:["v-radio",i.class],style:i.style,type:"radio"}),o)}),{}}}),st={class:"d-flex py-2 bottom-border"},ot={class:"text-lg"},rt={key:1},lt=x({__name:"StudentRegisted",props:{items:{type:Array,required:!0},topicId:{type:Number,required:!0}},emits:["refetch"],setup(i,{emit:l}){const o=i,d=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"MASV",key:"maso",width:"20%",minWidth:150},{title:"HỌ ĐỆM",key:"hodem",width:"25%",minWidth:200},{title:"TÊN",key:"ten",width:"15%",minWidth:100},{title:"LỚP",key:"lop",width:"20%",minWidth:150},{title:"NHÓM",key:"nhom",width:"10%",minWidth:100},{title:"TẠO NHÓM",key:"action",minWidth:50,align:"center"}],e=C(null),n=G(),{$api:t,$toast:a}=_(),v=l,f=A=>{e.value=A.id},b=()=>{t.studentTopic.createGroup({partner_id:e.value,topic_id:o.topicId}).then(()=>{v("refetch"),a.success("Tạo nhóm thành công")}).finally(()=>v("refetch"))};return(A,S)=>(c(),$("div",null,[u("div",st,[u("div",ot,"Danh sách sinh viên đăng ký cùng đề tài "+h(m(e)),1),p(R),p(V,{color:"success",disabled:!m(e),size:"small",onClick:b},{default:s(()=>S[1]||(S[1]=[w("Tạo")])),_:1},8,["disabled"])]),p(W,{class:"mt-2",headers:d,"hide-default-footer":"",items:i.items},{"item.index":s(({index:y})=>[u("span",null,h(y+1),1)]),"item.nhom":s(({item:y})=>{var g;return[u("span",null,h((g=y.studentTopic[0])==null?void 0:g.group_id),1)]}),"item.action":s(({item:y})=>{var g,r;return[!y.nhom&&((g=m(n).data)==null?void 0:g.value.id)!=y.id&&!((r=y.studentTopic[0])!=null&&r.group_id)?(c(),k(nt,{key:0,modelValue:m(e),"onUpdate:modelValue":S[0]||(S[0]=T=>D(e)?e.value=T:null),"false-value":!m(e),value:y.id,onClick:T=>f(y)},null,8,["modelValue","false-value","value","onClick"])):(c(),$("div",rt))]}),_:1},8,["items"])]))}}),at={class:"d-flex py-2 bottom-border"},dt={class:"text-lg"},ut=x({__name:"PartnerRegisted",props:{items:{type:Array,required:!0},topicId:{type:Number,required:!0}},emits:["refetch"],setup(i,{emit:l}){const o=[{title:"STT",align:"start",sortable:!1,key:"index",width:50},{title:"MASV",key:"maso",width:"20%",minWidth:150},{title:"HỌ ĐỆM",key:"hodem",width:"25%",minWidth:200},{title:"TÊN",key:"ten"},{title:"LỚP",key:"lop",width:"20%",minWidth:150}],d=C(null);G();const{$api:e,$toast:n}=_(),t=l,a=()=>{e.studentTopic.cancelGroup().then(()=>{t("refetch"),n.success("Tạo nhóm thành công")})};return(v,f)=>(c(),$("div",null,[u("div",at,[u("div",dt,"Danh sách sinh viên nhóm "+h(m(d)),1),p(R),p(V,{color:"error",size:"small",onClick:a},{default:s(()=>f[0]||(f[0]=[w("Hủy nhóm")])),_:1})]),p(W,{class:"mt-2",headers:o,"hide-default-footer":"",items:i.items},{"item.index":s(({index:b})=>[u("span",null,h(b+1),1)]),_:1},8,["items"])]))}}),ct=x({__name:"TopicRegistedSuccess",props:{items:{type:Object,required:!0}},emits:["refetch","viewAll"],setup(i,{emit:l}){const o=l;return(d,e)=>{var n,t;return c(),$(q,null,[p(et,{items:[i.items.topic.topic],"number-student":(n=i.items)==null?void 0:n.students.length,partner:i.items.partner,onRefetch:e[0]||(e[0]=a=>o("refetch")),onViewAll:e[1]||(e[1]=a=>o("viewAll"))},null,8,["items","number-student","partner"]),((t=i.items.partner)==null?void 0:t.length)>1?(c(),k(ut,{key:0,class:"mt-6",items:i.items.partner,"topic-id":i.items.topic.topic_id,onRefetch:e[2]||(e[2]=a=>o("refetch"))},null,8,["items","topic-id"])):(c(),k(lt,{key:1,class:"mt-6",items:i.items.students,"topic-id":i.items.topic.topic_id,onRefetch:e[3]||(e[3]=a=>o("refetch"))},null,8,["items","topic-id"]))],64)}}});function mt(i,l){const{$api:o}=_(),d=O(["registed-topic",i],()=>o.studentTopic.getRegistedTopic(),{refetchOnWindowFocus:!1,...l}),e=M(()=>{var n;return((n=d.data.value)==null?void 0:n.data)||[]});return{...d,items:e}}const pt={class:"d-flex flex-column flex-grow-1 h-full"},ht={key:0,class:"h-full"},At=x({__name:"index",setup(i){const{items:l,isLoading:o,refetch:d}=mt(null,{retry:0}),e=C(!1);return(n,t)=>(c(),$("div",pt,[t[4]||(t[4]=u("div",{class:"text-lg font-bold text-uppercase"},"Đăng ký đề tài đồ án",-1)),p(j,{class:"pa-3 h-full",color:"white",variant:"flat"},{default:s(()=>[m(l).topic?(c(),$("div",ht,[!m(l).topic.topic_id||m(e)?(c(),k(U,{key:0,"topic-id":m(l).topic.topic_id,onSuccess:t[0]||(t[0]=a=>m(d)()),onViewAll:t[1]||(t[1]=a=>e.value=!1)},null,8,["topic-id"])):(c(),k(ct,{key:1,items:m(l),onRefetch:t[2]||(t[2]=a=>m(d)()),onViewAll:t[3]||(t[3]=a=>e.value=!0)},null,8,["items"]))])):Q("",!0)]),_:1})]))}});export{At as default};
