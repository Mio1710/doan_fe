import{a as P,O as j,i as S,d as z,r as k,F as K,t as w,L as W,A as n,z as l,x as e,v as C,X as I,K as F,M as g,y as m,Y as X,aO as Y,aP as J,P as G,N as E,T as Z,S as U,W as ee,R as N,B as R,V as O,Q as A}from"./CFiehynL.js";import{P as te,_ as M}from"./DZ_F3gcz.js";import{_ as H}from"./1adOK-vi.js";import{a as ne,V as se}from"./CZ9s_aoN.js";import{u as le}from"./CZ368CUa.js";import{_ as ae}from"./BjrrArms.js";import{V as ie,a as oe,b as re,c as ce}from"./DuUUWDLQ.js";import{V as ue}from"./DBYuLB8G.js";import{V as Q}from"./DnFUZBxv.js";import"./nflsgOpI.js";import"./VaKneH-D.js";import"./CISklGHC.js";import"./CN8nOB4F.js";import"./BBJD5s-R.js";import"./D00urTNM.js";import"./40oRFHCv.js";function de(t,f){return t?Array.isArray(t)?M.map(M.zip(t,f),([h,u])=>u==="desc"?`-${h}`:h):[f==="desc"?`-${t}`:t]:[]}function me(t,f){const{$api:h}=P(),u=j(["student-topic",t],()=>{const{sortBy:p,sortType:v}=t.value,V=de(p,v),o=new te({includes:[],appends:[],fields:{},filters:{},sorts:V,page:t.value.page,limit:t.value.rowsPerPage,payload:null,...t.value}).query();return h.teacher.getStudentTopics(o)},{refetchOnWindowFocus:!1,...f}),x=S(()=>{var p;return((p=u.data.value)==null?void 0:p.data)||[]}),y=S(()=>{var p,v;return((v=(p=u.data.value)==null?void 0:p.pagination)==null?void 0:v.total)||0});return{...u,items:x,totalItems:y}}function pe(t,f){const{$api:h}=P();console.log("params in useQuery",t);const u=j(["student-result-topic-los",t],()=>h.teacher.getStudentResultLOs(t),{refetchOnWindowFocus:!1,...f}),x=S(()=>{var y;return((y=u.data.value)==null?void 0:y.data)||[]});return{...u,items:x}}const fe={class:"text-center"},he={class:"text-center"},ve={class:"text-center"},_e={class:"text-center font-weight-bold text-error py-2"},ge=z({__name:"ResultDetail",props:{item:{type:Object,required:!0}},emits:["cancel","success"],setup(t,{emit:f}){const h=t,{$api:u,$toast:x}=P(),y=k(h.item.id),{items:p,isLoading:v,error:V,refetch:o}=pe({studentId:y.value}),r=[{title:"STT",align:"center",sortable:!1,value:"index",width:20},{title:"Tiêu chí đánh giá",value:"main_criteria",width:"50%",minWidth:500},{title:"Tiêu chí phụ",value:"sub_criteria",width:"30%",minWidth:100},{title:"Hệ số",value:"cof",width:"7%",minWidth:50},{title:"Điểm",value:"score",width:"7%",minWidth:50}],s=k(p.value.map(_=>({..._}))),b=f;K(()=>p.value,_=>{s.value=_.map(d=>({...d}))});const B=(_,d)=>{(_.score<0||_.score>10)&&(s.value[d].score="",x.error("Vui lòng điền điểm hợp lệ (0 - 10)"))},D=()=>{u.teacher.updateStudentResultLOs(s.value).then(()=>{x.success("Cập nhật điểm thành công"),b("success")}).finally(()=>{b("cancel")})},T=S(()=>s.value.reduce((_,d)=>_+d.score*d.cof,0));return(_,d)=>{var i,$;return w(),W(H,{"can-cancel":"","cancel-text":"Đóng",title:`Điểm quá trình của sinh viên: ${(i=t.item)==null?void 0:i.hodem} ${($=t.item)==null?void 0:$.ten}`,onCancel:d[0]||(d[0]=a=>b("cancel")),onSubmit:D},{default:n(()=>[l(ne,{class:"elevation-1"},{default:n(()=>[e("thead",null,[e("tr",null,[(w(),C(F,null,I(r,a=>e("th",{key:a.value,class:X(`text-${a.align}`),style:Y({width:a.width})},m(a.title),7)),64))])]),e("tbody",null,[(w(!0),C(F,null,I(g(s),(a,c)=>(w(),C("tr",{key:c,class:"v-data-table__tr"},[e("td",fe,m(c+1),1),e("td",null,m(a.main_criteria),1),e("td",null,m(a.sub_criteria),1),e("td",he,m(a.cof),1),e("td",ve,[l(J,{modelValue:a.score,"onUpdate:modelValue":q=>a.score=q,type:"number",variant:"plain",onChange:q=>B(a,c)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]))),128))])]),_:1}),e("div",_e,[e("span",null,"Điểm tổng: "+m((g(T)/10).toFixed(2)),1)])]),_:1},8,["title"])}}}),xe={key:0},ye={class:"d-flex w-full"},we={class:"d-flex items-center"},Ve=["onClick"],$e=z({__name:"ReportDetail",props:{item:{type:Object,required:!0}},emits:["cancel","success"],setup(t,{emit:f}){const h=t;k(!1);const{$api:u,$toast:x}=P(),y=G(),p=f,v=d=>{u.reportTopic.downloadReportTopic(d.file_key).then(i=>{const $=URL.createObjectURL(new Blob([i])),a=document.createElement("a");a.href=$,a.setAttribute("download",d.file_name),document.body.appendChild(a),a.click()})},V=k([]),o=h.item.id,r=S(()=>({filters:{studentId:o}})),{items:s,totalItems:b,isLoading:B,refetch:D}=le(r,{enabled:!!o}),T=k(""),_=d=>{u.teacher.commentStudentReportTopic(d.id,{comment:T.value}).then(()=>{x.success("Cập nhật nhận xét thành công"),y.invalidateQueries("student-report-topic")})};return(d,i)=>{var $,a;return w(),W(H,{"can-cancel":"","cancel-text":"Đóng","hide-submit":"",title:`Điểm quá trình của sinh viên: ${($=t.item)==null?void 0:$.hodem} ${(a=t.item)==null?void 0:a.ten}`,onCancel:i[2]||(i[2]=c=>p("cancel"))},{default:n(()=>[g(s)?(w(),C("div",xe,[l(ie,{modelValue:g(V),"onUpdate:modelValue":i[1]||(i[1]=c=>E(V)?V.value=c:null),multiple:""},{default:n(()=>[(w(!0),C(F,null,I(g(s),(c,q)=>(w(),W(oe,{key:q},{default:n(()=>[l(re,null,{default:n(()=>[e("div",ye,[e("span",null,"Tuần "+m(c.week),1),l(U),e("div",null,"Nộp lúc: "+m(g(ee)(new Date(c==null?void 0:c.created_at),"dd/MM/yyyy HH:mm")),1)])]),_:2},1024),l(ce,null,{default:n(()=>[e("div",we,[e("div",null,[i[3]||(i[3]=e("span",{class:"font-weight-bold"},"File báo cáo:",-1)),e("span",{class:"cursor-pointer underline text-blue-400 ml-2",onClick:L=>v(c)},m(c.file_name),9,Ve)]),l(U),l(N,{color:"success",height:"20",icon:"mdi-content-save-check",size:"small",variant:"plain",onClick:L=>_(c)},null,8,["onClick"])]),e("div",null,[e("div",null,[i[4]||(i[4]=e("span",{class:"font-weight-bold"},"Mô tả:",-1)),R(" "+m(c.description),1)]),i[5]||(i[5]=e("div",{class:"font-weight-bold"},"Nhận xét của giảng viên:",-1)),e("div",null,[l(ae,{modelValue:g(T),"onUpdate:modelValue":i[0]||(i[0]=L=>E(T)?T.value=L:null),class:"mb-4",label:"Nhận xét của giảng viên","model-value":c.comment,name:"Nhận xét của giảng viên",rules:"required",type:"textarea"},null,8,["modelValue","model-value"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])])):Z("",!0)]),_:1},8,["title"])}}}),be={class:"d-flex flex-column flex-grow-1 h-full"},Te={class:"mt-2"},ke={class:"d-flex"},Ae=z({__name:"index",setup(t){const f=[{title:"STT",align:"center",sortable:!1,key:"index",width:50},{title:"Tên sinh viên",key:"ten",width:"15%",minWidth:150},{title:"MSSV",key:"maso",width:"10%",minWidth:100},{title:"Lớp",key:"lop",width:"15%",minWidth:150},{title:"Nhóm",key:"nhom",width:"5%",minWidth:50},{title:"Đề tài",key:"topic"},{title:"Nhập điểm",key:"action",width:150,sortable:!1,align:"center"}],h=k({page:1,rowsPerPage:25,sortBy:"-created_at",sortType:"asc"}),u=S(()=>({...h.value}));P(),G();const{items:x,totalItems:y,isLoading:p,refetch:v}=me(u);return(V,o)=>(w(),C("div",be,[o[4]||(o[4]=e("div",{class:"text-lg font-bold text-uppercase"},"Sinh viên khóa luận",-1)),l(ue,{class:"pa-3 pt-0 h-full",color:"white",variant:"flat"},{default:n(()=>[e("div",Te,[e("div",ke,[l(U),l(N,{icon:"",size:"x-small",variant:"text",onClick:o[0]||(o[0]=r=>g(v)())},{default:n(()=>[l(O,null,{default:n(()=>o[1]||(o[1]=[R("mdi-refresh")])),_:1})]),_:1})]),l(se,{headers:f,"hide-default-footer":"",items:g(x)},{"item.index":n(({index:r})=>[e("span",null,m(r+1),1)]),"item.ten":n(({item:r})=>[e("span",null,m(r.hodem+" "+r.ten),1)]),"item.nhom":n(({item:r})=>{var s;return[e("span",null,m((s=r.studentTopic[0])==null?void 0:s.group_id),1)]}),"item.topic":n(({item:r})=>{var s;return[e("span",null,m((s=r.studentTopic[0])==null?void 0:s.topic.ten),1)]}),"item.action":n(({item:r})=>[l(Q,{"min-width":"800",width:"80%"},{activator:n(({props:s})=>[l(N,A({rounded:"",variant:"text"},s),{default:n(()=>[l(O,{color:"success"},{default:n(()=>o[2]||(o[2]=[R("mdi-eye")])),_:1})]),_:2},1040)]),default:n(({isActive:s})=>[l($e,{item:r,onCancel:b=>s.value=!1,onSuccess:g(v)},null,8,["item","onCancel","onSuccess"])]),_:2},1024),l(Q,{"min-width":"800",width:"80%"},{activator:n(({props:s})=>[l(N,A({rounded:"",variant:"text"},s),{default:n(()=>[l(O,{color:"success"},{default:n(()=>o[3]||(o[3]=[R("mdi-pencil")])),_:1})]),_:2},1040)]),default:n(({isActive:s})=>[l(ge,{item:r,onCancel:b=>s.value=!1,onSuccess:g(v)},null,8,["item","onCancel","onSuccess"])]),_:2},1024)]),_:1},8,["items"])])]),_:1})]))}});export{Ae as default};
